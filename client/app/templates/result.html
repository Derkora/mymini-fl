{% extends "layout.html" %}

{% block content %}
<div style="text-align: center;">
    {% if status == 'success' or status == 'registered' %}
        <h1 style="color: green;">Berhasil</h1>
    {% elif status == 'unknown' %}
        <h1 style="color: orange;">Wajah Tidak Dikenali</h1>
    {% else %}
        <h1 style="color: red;">Gagal</h1>
    {% endif %}

    <div class="status-box {{ 'success' if status in ['success', 'registered'] else 'error' }}">
        <h3>{{ message }}</h3>
        
        {% if details %}
        <ul style="list-style: none; padding: 0;">
            {% if details['Drawn Image B64'] %}
                <li>
                    <strong>Gambar Absensi dengan Bounding Box:</strong><br>
                    <img src="data:image/jpeg;base64,{{ details['Drawn Image B64'] }}" style="max-width: 300px; border: 1px solid #ccc; margin-top: 10px;">
                </li>
            {% endif %}
            
            {% for key, value in details.items() %}
                {% if key != 'Drawn Image B64' and key != 'Debug Logs' %}
                    <li><strong>{{ key }}:</strong> {{ value }}</li>
                {% endif %}
            {% endfor %}
        </ul>
        {% endif %}

        {% if registration_logs %}
        <h4 style="margin-top: 20px;">Log Visual Pendaftaran (MTCNN, Crop, Augmentasi)</h4>
        <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 15px;">
            {% for log in registration_logs %}
            <div style="border: 1px solid #ddd; padding: 10px; width: 250px; text-align: left;">
                <p><strong>Sumber:</strong> {{ log.source }}</p>
                <p><strong>Status:</strong> <span style="color: {{ 'green' if log.status == 'Success' else 'red' }}">{{ log.status }}</span></p>
                
                {% if log.original_img_with_bb_b64 %}
                <p><strong>Deteksi Wajah:</strong></p>
                <img src="data:image/jpeg;base64,{{ log.original_img_with_bb_b64 }}" style="max-width: 100%; height: auto; border: 1px solid #ccc;">
                {% endif %}
                
                {% if log.cropped_face_b64 %}
                <p style="margin-top: 10px;"><strong>Wajah di-Crop (112x112):</strong></p>
                <img src="data:image/jpeg;base64,{{ log.cropped_face_b64 }}" style="width: 112px; height: 112px; border: 1px solid #ccc;">
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% endif %}
        
    </div>

    <div style="margin-top: 30px;">
        <a href="/" class="btn">Kembali ke Dashboard</a>
        {% if next_url %}
            <a href="{{ next_url }}" class="btn btn-secondary">{{ next_label }}</a>
        {% endif %}
    </div>
</div>
{% endblock %}